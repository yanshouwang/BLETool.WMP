"use strict";
var app = getApp();
function inArray(arr, key, val) {
    for (var i = 0; i < arr.length; i++) {
        if (arr[i][key] === val) {
            return i;
        }
    }
    return -1;
}
Page({
    mDiscoveryStarted: false,
    data: {
        motto: 'Hello WeChat',
        userInfo: {},
        hasUserInfo: false,
        canIUse: wx.canIUse('button.open-type.getUserInfo'),
        devices: []
    },
    bindViewTap: function () {
        wx.scanCode({
            scanType: ["qrCode"],
            success: function (res) {
                var option = {
                    "title": res.result,
                    "duration": 5000
                };
                wx.showToast(option);
            }
        });
    },
    onLoad: function () {
        var _this = this;
        if (app.globalData.userInfo) {
            this.setData({
                userInfo: app.globalData.userInfo,
                hasUserInfo: true,
            });
        }
        else if (this.data.canIUse) {
            app.userInfoReadyCallback = function (res) {
                _this.setData({
                    userInfo: res.userInfo,
                    hasUserInfo: true,
                });
            };
        }
        else {
            wx.getUserInfo({
                success: function (res) {
                    app.globalData.userInfo = res.userInfo;
                    _this.setData({
                        userInfo: res.userInfo,
                        hasUserInfo: true,
                    });
                },
            });
        }
    },
    getUserInfo: function (e) {
        console.log(e);
        app.globalData.userInfo = e.detail.userInfo;
        this.setData({
            userInfo: e.detail.userInfo,
            hasUserInfo: true,
        });
    },
    startScan: function () {
        var _this = this;
        var option = {
            success: function () { return _this.startDiscovery(); }
        };
        wx.openBluetoothAdapter(option);
    },
    startDiscovery: function () {
        var _this = this;
        if (this.mDiscoveryStarted) {
            return;
        }
        this.mDiscoveryStarted = true;
        var callback = function (res) {
            res.devices.forEach(function (device) {
                var data = {};
                var i = inArray(_this.data.devices, 'deviceId', device.deviceId);
                if (i === -1) {
                    var length = _this.data.devices.length;
                    data["devices[" + length + "]"] = device;
                }
                else {
                    data["devices[" + i + "]"] = device;
                }
                _this.setData(data);
            });
        };
        var option = {
            success: function () { return wx.onBluetoothDeviceFound(callback); }
        };
        wx.startBluetoothDevicesDiscovery(option);
    },
    navigate: function () {
        var option = {
            url: '../device/device'
        };
        wx.navigateTo(option);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFjLENBQUE7QUFFaEMsU0FBUyxPQUFPLENBQUMsR0FBbUIsRUFBRSxHQUFvQixFQUFFLEdBQVE7SUFDbEUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDbkMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssR0FBRyxFQUFFO1lBQ3ZCLE9BQU8sQ0FBQyxDQUFDO1NBQ1Y7S0FDRjtJQUNELE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDWixDQUFDO0FBRUQsSUFBSSxDQUFDO0lBQ0gsaUJBQWlCLEVBQUUsS0FBSztJQUN4QixJQUFJLEVBQUU7UUFDSixLQUFLLEVBQUUsY0FBYztRQUNyQixRQUFRLEVBQUUsRUFBRTtRQUNaLFdBQVcsRUFBRSxLQUFLO1FBQ2xCLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLDhCQUE4QixDQUFDO1FBQ25ELE9BQU8sRUFBRSxFQUtSO0tBQ0Y7SUFFRCxXQUFXLEVBQVg7UUFDRSxFQUFFLENBQUMsUUFBUSxDQUFDO1lBQ1YsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDO1lBQ3BCLE9BQU8sRUFBRSxVQUFBLEdBQUc7Z0JBQ1YsSUFBTSxNQUFNLEdBQXNDO29CQUNoRCxPQUFPLEVBQUUsR0FBRyxDQUFDLE1BQU07b0JBQ25CLFVBQVUsRUFBRSxJQUFJO2lCQUNqQixDQUFBO2dCQUNELEVBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkIsQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUlKLENBQUM7SUFDRCxNQUFNO1FBQU4saUJBMkJDO1FBMUJDLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUU7WUFD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Q3hCLENBQUM7UUFDRixFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hCLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbmRleC50c1xyXG4vLyDojrflj5blupTnlKjlrp7kvotcclxuY29uc3QgYXBwID0gZ2V0QXBwPElBcHBPcHRpb24+KClcclxuXHJcbmZ1bmN0aW9uIGluQXJyYXkoYXJyOiBzdHJpbmcgfCBhbnlbXSwga2V5OiBzdHJpbmcgfCBudW1iZXIsIHZhbDogYW55KSB7XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuICAgIGlmIChhcnJbaV1ba2V5XSA9PT0gdmFsKSB7XHJcbiAgICAgIHJldHVybiBpO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gLTE7XHJcbn1cclxuXHJcblBhZ2Uoe1xyXG4gIG1EaXNjb3ZlcnlTdGFydGVkOiBmYWxzZSxcclxuICBkYXRhOiB7XHJcbiAgICBtb3R0bzogJ0hlbGxvIFdlQ2hhdCcsXHJcbiAgICB1c2VySW5mbzoge30sXHJcbiAgICBoYXNVc2VySW5mbzogZmFsc2UsXHJcbiAgICBjYW5JVXNlOiB3eC5jYW5JVXNlKCdidXR0b24ub3Blbi10eXBlLmdldFVzZXJJbmZvJyksXHJcbiAgICBkZXZpY2VzOiBbXHJcbiAgICAgIC8vIHtcclxuICAgICAgLy8gICBkZXZpY2VJZDogJ0NBNTlCMTJFLUEwMzItNEUzMC04RjNCLTJBMEZCQUVGMzBBQScsXHJcbiAgICAgIC8vICAgbmFtZTogJ01PQ0sgQkxFJ1xyXG4gICAgICAvLyB9XHJcbiAgICBdXHJcbiAgfSxcclxuICAvLyDkuovku7blpITnkIblh73mlbBcclxuICBiaW5kVmlld1RhcCgpIHtcclxuICAgIHd4LnNjYW5Db2RlKHtcclxuICAgICAgc2NhblR5cGU6IFtcInFyQ29kZVwiXSxcclxuICAgICAgc3VjY2VzczogcmVzID0+IHtcclxuICAgICAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLlNob3dUb2FzdE9wdGlvbiA9IHtcclxuICAgICAgICAgIFwidGl0bGVcIjogcmVzLnJlc3VsdCxcclxuICAgICAgICAgIFwiZHVyYXRpb25cIjogNTAwMFxyXG4gICAgICAgIH1cclxuICAgICAgICB3eC5zaG93VG9hc3Qob3B0aW9uKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIC8vIHd4Lm5hdmlnYXRlVG8oe1xyXG4gICAgLy8gICB1cmw6ICcuLi9sb2dzL2xvZ3MnLFxyXG4gICAgLy8gfSlcclxuICB9LFxyXG4gIG9uTG9hZCgpIHtcclxuICAgIGlmIChhcHAuZ2xvYmFsRGF0YS51c2VySW5mbykge1xyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIHVzZXJJbmZvOiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mbyxcclxuICAgICAgICBoYXNVc2VySW5mbzogdHJ1ZSxcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLmNhbklVc2UpIHtcclxuICAgICAgLy8g55Sx5LqOIGdldFVzZXJJbmZvIOaYr+e9kee7nOivt+axgu+8jOWPr+iDveS8muWcqCBQYWdlLm9uTG9hZCDkuYvlkI7miY3ov5Tlm55cclxuICAgICAgLy8g5omA5Lul5q2k5aSE5Yqg5YWlIGNhbGxiYWNrIOS7pemYsuatoui/meenjeaDheWGtVxyXG4gICAgICBhcHAudXNlckluZm9SZWFkeUNhbGxiYWNrID0gcmVzID0+IHtcclxuICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgdXNlckluZm86IHJlcy51c2VySW5mbyxcclxuICAgICAgICAgIGhhc1VzZXJJbmZvOiB0cnVlLFxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIOWcqOayoeaciSBvcGVuLXR5cGU9Z2V0VXNlckluZm8g54mI5pys55qE5YW85a655aSE55CGXHJcbiAgICAgIHd4LmdldFVzZXJJbmZvKHtcclxuICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xyXG4gICAgICAgICAgYXBwLmdsb2JhbERhdGEudXNlckluZm8gPSByZXMudXNlckluZm9cclxuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgIHVzZXJJbmZvOiByZXMudXNlckluZm8sXHJcbiAgICAgICAgICAgIGhhc1VzZXJJbmZvOiB0cnVlLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgZ2V0VXNlckluZm8oZTogYW55KSB7XHJcbiAgICBjb25zb2xlLmxvZyhlKVxyXG4gICAgYXBwLmdsb2JhbERhdGEudXNlckluZm8gPSBlLmRldGFpbC51c2VySW5mb1xyXG4gICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgdXNlckluZm86IGUuZGV0YWlsLnVzZXJJbmZvLFxyXG4gICAgICBoYXNVc2VySW5mbzogdHJ1ZSxcclxuICAgIH0pXHJcbiAgfSxcclxuICBzdGFydFNjYW4oKSB7XHJcbiAgICBjb25zdCBvcHRpb246IFdlY2hhdE1pbmlwcm9ncmFtLk9wZW5CbHVldG9vdGhBZGFwdGVyT3B0aW9uID0ge1xyXG4gICAgICBzdWNjZXNzOiAoKSA9PiB0aGlzLnN0YXJ0RGlzY292ZXJ5KClcclxuICAgIH1cclxuICAgIHd4Lm9wZW5CbHVldG9vdGhBZGFwdGVyKG9wdGlvbilcclxuICB9LFxyXG4gIHN0YXJ0RGlzY292ZXJ5KCkge1xyXG4gICAgaWYgKHRoaXMubURpc2NvdmVyeVN0YXJ0ZWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tRGlzY292ZXJ5U3RhcnRlZCA9IHRydWVcclxuICAgIGNvbnN0IGNhbGxiYWNrOiBXZWNoYXRNaW5pcHJvZ3JhbS5PbkJsdWV0b290aERldmljZUZvdW5kQ2FsbGJhY2sgPSByZXMgPT4ge1xyXG4gICAgICByZXMuZGV2aWNlcy5mb3JFYWNoKGRldmljZSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGF0YTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG4gICAgICAgIGNvbnN0IGkgPSBpbkFycmF5KHRoaXMuZGF0YS5kZXZpY2VzLCAnZGV2aWNlSWQnLCBkZXZpY2UuZGV2aWNlSWQpO1xyXG4gICAgICAgIGlmIChpID09PSAtMSkge1xyXG4gICAgICAgICAgY29uc3QgbGVuZ3RoID0gdGhpcy5kYXRhLmRldmljZXMubGVuZ3RoO1xyXG4gICAgICAgICAgZGF0YVtgZGV2aWNlc1ske2xlbmd0aH1dYF0gPSBkZXZpY2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGRhdGFbYGRldmljZXNbJHtpfV1gXSA9IGRldmljZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXREYXRhKGRhdGEpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IG9wdGlvbjogV2VjaGF0TWluaXByb2dyYW0uU3RhcnRCbHVldG9vdGhEZXZpY2VzRGlzY292ZXJ5T3B0aW9uID0ge1xyXG4gICAgICBzdWNjZXNzOiAoKSA9PiB3eC5vbkJsdWV0b290aERldmljZUZvdW5kKGNhbGxiYWNrKVxyXG4gICAgfVxyXG4gICAgd3guc3RhcnRCbHVldG9vdGhEZXZpY2VzRGlzY292ZXJ5KG9wdGlvbik7XHJcbiAgfSxcclxuICBuYXZpZ2F0ZSgpIHtcclxuICAgIGNvbnN0IG9wdGlvbjogV2VjaGF0TWluaXByb2dyYW0uTmF2aWdhdGVUb09wdGlvbiA9IHtcclxuICAgICAgdXJsOiAnLi4vZGV2aWNlL2RldmljZSdcclxuICAgIH07XHJcbiAgICB3eC5uYXZpZ2F0ZVRvKG9wdGlvbik7XHJcbiAgfVxyXG59KVxyXG4iXX0=